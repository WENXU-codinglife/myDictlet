<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>
            FLASHCARD
            <meta charset="UTF-8">
        </title>
    </head>
    <body onload="loadlabels()">
        <h1 style="text-align:center;">
            MyDictlet
        </h1>


        <p>Enter the word you want to know:</p>
        <input type="text" id="new_word">
        <button id = "btn">Lookup</button>
        <button id = "add">Add to flashcard</button>

        
        <p>***Click the "Lookup" button and the form-data will be sent to a page on the 
        server called "action_page.php".***</p>
        
        <div id="demo" style="border: gray; background-color: honeydew;"></div>

        <div>flashcard</div>
        <div id = "labelofcard"></div>

		<!-- Scripts -->
        <script src="assets/js/jquery.min.js"></script>
        <script src="assets/js/skel.min.js"></script>
        <script src="assets/js/util.js"></script>
        <script src="assets/js/main.js"></script>

        <script>
        // load labels of flashcards
        function loadlabels(){
            console.log("loadlabels");
            $(document).ready(function() {
                var qurl="/passmelabels";
                $.ajax({
                    type: "POST",
                    cache: false,
                    data:{keyword:'passmelabels'},
                    url: qurl,
                    dataType: "json",
                    //not understand what the codes are for
                    success: function(response) { 
                        console.log(response);  
                        let htmlText = '' 
                        let n = response["count"];
                        for(let i = 0; i < n; i++){
                            htmlText = htmlText + "<div><a href='./flashcard.html'>" + response["dates"][i] + "</a></div>";
                        } 
                        document.getElementById("labelofcard").innerHTML = htmlText;
                    },
                    error: function(response) {
                        console.log(error); 
                    }
                })
            });
        }
        </script>

        <script>

        //lookup
        var btn = document.getElementById("btn");
        var app_key = 'c1f42caf-a67f-46b9-aba6-e14c23e777e5';
        let aAudio = new Audio();

        function extr(word) {
            var request = new XMLHttpRequest()
            var htmlText = '';
            // Open a new connection, using the GET request on the URL endpoint
            request.open('GET', 'https://www.dictionaryapi.com/api/v3/references/collegiate/json/' + word + '?key=' + app_key, true)

            request.onload = function() {
            // Begin accessing JSON data here
                
                var mydata = JSON.parse(this.responseText);
                //console.log(mydata);
                let audio = mydata[0].hwi.prs[0].sound.audio;
                let rcs = "https://media.merriam-webster.com/soundc11/" + word[0] + "/" + audio + ".wav";
                aAudio = new Audio(rcs);

                htmlText += '<a onclick="myAudioFunction();"> <img src = "./images/edifier.svg" style = "width = "15px"; height = "15px""> </img> </a>';
                let index = 0;
                for(let i = 0; i < mydata.length; i++){
                    index = i + 1;
                    //console.log('Sense ' + index + '\n');
                    htmlText +='<p>' + 'Sense ' + index + '</p>';
                    let jj = 0;
                    for(let j = 0; j < mydata[i].shortdef.length; j++){
                        //console.log(mydata[i].shortdef[j] + '\n');
                        jj = j+1;
                        htmlText +='<p>' + jj + '. ' +  mydata[i].shortdef[j] + '</p>';
                        document.getElementById("demo").innerHTML = htmlText;
                    }
                }
            }

            // Send request
            request.send()
        }

        function myAudioFunction() {
            aAudio.play();
        }

        btn.addEventListener("click", function(){
            var newword = document.getElementById("new_word").value;
            let mydata = extr(newword);
        });


        //add to flashcard
        addtoflashcard = document.getElementById("add");
        addtoflashcard.addEventListener("click", function(){
            var newword =  document.getElementById("new_word").value;
            newword = newword.toLowerCase();
            console.log(newword);
            if(newword != ''){
                $(document).ready(function() {
                    var qurl="/flashcard";
                    $.ajax({
                        type: "POST",
                        cache: false,
                        data:{keyword:newword},
                        url: qurl,
                        dataType: "json",
                        //not understand what the codes are for
                        success: function(response) { 
                            console.log(response);
                            if(response['feedback']){
                                if (confirm("The word '" + newword +"' has been added successfully!")) { 
                                } else {
                                } 
                            }else{
                                alert("WOOPS! There is something wrong!");
                            }
                        },
                        error: function(response) {
                            console.log(error); 
                        }
                    })
                });
            }
            else{
                alert("Please enter the word that you want to add!");
            };
        })
        </script>

    </body>
</html>